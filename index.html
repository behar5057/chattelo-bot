<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chattelo - Random Anonymous Chat</title>
    <style>
        /* KEEP ALL YOUR EXISTING CSS - IT'S PERFECT */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; min-height: 100vh; }
        .container { max-width: 400px; margin: 0 auto; padding: 20px; text-align: center; }
        .logo { font-size: 80px; margin: 30px 0 10px; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        h1 { font-size: 32px; margin-bottom: 10px; font-weight: 700; }
        .tagline { font-size: 16px; opacity: 0.9; margin-bottom: 30px; }
        .btn { display: block; width: 100%; padding: 18px; margin: 15px 0; border: none; border-radius: 15px; font-size: 18px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; text-decoration: none; text-align: center; }
        .btn-primary { background: #4cd964; color: white; box-shadow: 0 8px 25px rgba(76, 217, 100, 0.3); }
        .btn-primary:hover { background: #44c554; transform: translateY(-2px); box-shadow: 0 12px 35px rgba(76, 217, 100, 0.4); }
        .btn-premium { background: linear-gradient(135deg, #ff6b6b, #ffa726); color: white; box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3); position: relative; overflow: hidden; }
        .btn-premium:hover { transform: translateY(-2px); box-shadow: 0 12px 35px rgba(255, 107, 107, 0.4); }
        .premium-badge { position: absolute; top: -8px; right: -8px; background: #ffd700; color: #000; padding: 4px 8px; border-radius: 10px; font-size: 10px; font-weight: bold; transform: rotate(15deg); }
        .pricing-card { background: rgba(255, 255, 255, 0.1); padding: 25px; border-radius: 20px; margin: 20px 0; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .price { font-size: 36px; font-weight: bold; margin: 10px 0; background: linear-gradient(135deg, #ff6b6b, #ffa726); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .chat-container { display: none; flex-direction: column; height: 100vh; background: white; color: #333; }
        .chat-header { background: #667eea; color: white; padding: 20px; text-align: center; position: relative; }
        .back-btn { position: absolute; left: 20px; background: none; border: none; color: white; font-size: 20px; cursor: pointer; }
        .chat-area { flex: 1; display: flex; flex-direction: column; background: #f8f9fa; }
        .messages-container { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .message { max-width: 80%; padding: 12px 16px; border-radius: 18px; font-size: 14px; line-height: 1.4; position: relative; transition: all 0.3s ease; }
        .message.received { background: #e5e5ea; color: #000; align-self: flex-start; border-bottom-left-radius: 4px; }
        .message.sent { background: #007aff; color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
        .message-input-container { padding: 15px; background: white; border-top: 1px solid #e5e5ea; display: flex; gap: 10px; }
        .message-input { flex: 1; padding: 12px 16px; border: 1px solid #e5e5ea; border-radius: 20px; font-size: 14px; outline: none; }
        .send-btn { background: #007aff; color: white; border: none; border-radius: 50%; width: 44px; height: 44px; font-size: 18px; cursor: pointer; }
        .waiting-message { text-align: center; padding: 40px 20px; color: #666; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .status-indicator { position: fixed; top: 10px; right: 10px; background: rgba(76, 217, 100, 0.9); color: white; padding: 5px 10px; border-radius: 10px; font-size: 12px; z-index: 1000; }
    </style>
</head>
<body>
    <div class="status-indicator" id="statusIndicator">üü¢ Chattelo Ready</div>

    <!-- Main Landing Page -->
    <div class="container" id="landingPage">
        <div class="logo">üí¨</div>
        <h1>Chattelo</h1>
        <p class="tagline">Chat with real people randomly - 100% Free</p>

        <button class="btn btn-primary" onclick="startRandomChat()">
            üí¨ START RANDOM CHAT
        </button>

        <button class="btn btn-premium" onclick="showPremiumModal()">
            üé• PREMIUM VIDEO CHAT
            <div class="premium-badge">PRO</div>
        </button>

        <!-- Pricing Card -->
        <div class="pricing-card">
            <h3>üé• Premium Video Chat</h3>
            <div class="price">$4.99</div>
            <p style="font-size: 14px; opacity: 0.8;">One-time payment ‚Ä¢ 30 days access</p>
            
            <div class="features-list">
                <div class="feature-item">
                    <span class="feature-icon">‚úÖ</span>
                    <span>HD Video Calls</span>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">‚úÖ</span>
                    <span>No Ads</span>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">‚úÖ</span>
                    <span>Priority Matching</span>
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="showPremiumModal()" style="margin-top: 15px;">
                ü§ñ GET PREMIUM ACCESS
            </button>
        </div>

        <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 15px;">
            <h4>üåç Live Statistics</h4>
            <p style="margin: 8px 0; font-size: 14px;">‚Ä¢ <span id="onlineCount">0</span> people online now</p>
            <p style="margin: 8px 0; font-size: 14px;">‚Ä¢ <span id="chatsToday">0</span> active chats</p>
            <p style="margin: 8px 0; font-size: 14px;">‚Ä¢ Connect with real people worldwide</p>
        </div>
    </div>

    <!-- Text Chat Interface -->
    <div class="chat-container" id="textChatPage">
        <div class="chat-header">
            <button class="back-btn" onclick="showLandingPage()">‚Üê</button>
            <h3 id="chatStatus">Finding a Partner...</h3>
            <div>Time: <span id="textChatTimer">00:00</span></div>
        </div>
        
        <div class="chat-area">
            <div class="messages-container" id="messagesContainer">
                <div class="waiting-message" id="waitingMessage">
                    <div class="spinner"></div>
                    <p>Looking for someone to chat with...</p>
                    <p style="font-size: 12px; margin-top: 10px;">Open multiple tabs to test connections!</p>
                    <div class="user-count" id="searchingCount">Waiting for users...</div>
                </div>
            </div>
            
            <div class="message-input-container">
                <input type="text" class="message-input" id="messageInput" placeholder="Type a message when connected..." onkeypress="handleKeyPress(event)" disabled>
                <button class="send-btn" onclick="sendMessage()" disabled>‚û§</button>
            </div>

            <div class="chat-controls">
                <button class="btn btn-primary" onclick="skipPerson()" style="margin: 10px;">‚è© Next Person</button>
            </div>
        </div>
    </div>

    <!-- Premium Modal -->
    <div class="premium-overlay" id="premiumModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); justify-content: center; align-items: center; z-index: 1000;">
        <div class="premium-modal" style="background: white; padding: 30px; border-radius: 20px; text-align: center; max-width: 350px; color: #333;">
            <button class="close-btn" onclick="closePremiumModal()" style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 20px; cursor: pointer; color: #666;">√ó</button>
            
            <div style="text-align: center;">
                <div style="font-size: 60px; margin: 20px 0;">üé•</div>
                <h2>Premium Video Chat</h2>
                <p style="margin: 15px 0; color: #666;">Coming Soon!</p>
            </div>

            <button class="btn btn-primary" onclick="closePremiumModal()" style="width: 100%; margin: 10px 0;">
                üëç Got It
            </button>
        </div>
    </div>

    <script>
        // ADVANCED LOCALSTORAGE CHAT SYSTEM FOR GITHUB PAGES
        class ChatteloNetwork {
            constructor() {
                this.userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                this.roomId = null;
                this.partnerId = null;
                this.isConnected = false;
                this.checkInterval = null;
                this.storageKey = 'chattelo_network_v2';
                this.lastUpdate = Date.now();
                
                this.initializeNetwork();
            }

            initializeNetwork() {
                // Clean old data
                this.cleanOldData();
                
                // Start listening for changes
                this.startStorageListener();
                
                // Update stats
                this.updateStats();
                
                console.log('Chattelo Network Initialized:', this.userId);
            }

            getNetworkData() {
                try {
                    return JSON.parse(localStorage.getItem(this.storageKey)) || {
                        users: {},
                        rooms: {},
                        waiting: [],
                        messages: {},
                        lastCleanup: Date.now()
                    };
                } catch {
                    return { users: {}, rooms: {}, waiting: [], messages: {}, lastCleanup: Date.now() };
                }
            }

            saveNetworkData(data) {
                try {
                    localStorage.setItem(this.storageKey, JSON.stringify(data));
                    this.lastUpdate = Date.now();
                } catch (error) {
                    console.log('Save error:', error);
                }
            }

            cleanOldData() {
                const data = this.getNetworkData();
                const now = Date.now();
                const FIVE_MINUTES = 5 * 60 * 1000;

                // Clean old users (5 minutes)
                Object.keys(data.users).forEach(userId => {
                    if (now - data.users[userId].lastSeen > FIVE_MINUTES) {
                        delete data.users[userId];
                    }
                });

                // Clean old rooms (10 minutes)
                Object.keys(data.rooms).forEach(roomId => {
                    if (now - data.rooms[roomId].created > FIVE_MINUTES * 2) {
                        delete data.rooms[roomId];
                        delete data.messages[roomId];
                    }
                });

                // Clean waiting list (2 minutes)
                data.waiting = data.waiting.filter(userId => {
                    return data.users[userId] && (now - data.users[userId].lastSeen < 120000);
                });

                data.lastCleanup = now;
                this.saveNetworkData(data);
            }

            startStorageListener() {
                // Listen for storage changes (other tabs)
                window.addEventListener('storage', (e) => {
                    if (e.key === this.storageKey) {
                        this.handleNetworkUpdate();
                    }
                });

                // Also check periodically
                this.checkInterval = setInterval(() => {
                    this.handleNetworkUpdate();
                }, 1000);
            }

            handleNetworkUpdate() {
                this.updateStats();
                
                if (this.roomId && this.isConnected) {
                    this.checkForNewMessages();
                }
            }

            updateStats() {
                const data = this.getNetworkData();
                const onlineUsers = Object.values(data.users).filter(user => 
                    Date.now() - user.lastSeen < 120000
                ).length;
                
                const activeRooms = Object.values(data.rooms).filter(room => 
                    Date.now() - room.lastActivity < 300000
                ).length;

                document.getElementById('onlineCount').textContent = onlineUsers;
                document.getElementById('chatsToday').textContent = activeRooms;
            }

            joinWaitingList() {
                const data = this.getNetworkData();
                
                // Update user info
                data.users[this.userId] = {
                    id: this.userId,
                    lastSeen: Date.now(),
                    status: 'waiting'
                };

                // Add to waiting list if not already there
                if (!data.waiting.includes(this.userId)) {
                    data.waiting.push(this.userId);
                }

                this.saveNetworkData(data);
                this.updateStats();

                return new Promise((resolve) => {
                    this.findPartner().then(partnerId => {
                        if (partnerId) {
                            resolve(partnerId);
                        } else {
                            // Keep trying
                            setTimeout(() => this.joinWaitingList().then(resolve), 2000);
                        }
                    });
                });
            }

            findPartner() {
                const data = this.getNetworkData();
                const partners = data.waiting.filter(id => id !== this.userId);
                
                if (partners.length > 0) {
                    this.partnerId = partners[0];
                    return Promise.resolve(this.partnerId);
                }
                
                return Promise.resolve(null);
            }

            createChatRoom() {
                this.roomId = 'room_' + Date.now();
                const data = this.getNetworkData();
                
                data.rooms[this.roomId] = {
                    user1: this.userId,
                    user2: this.partnerId,
                    created: Date.now(),
                    lastActivity: Date.now()
                };

                // Remove from waiting
                data.waiting = data.waiting.filter(id => 
                    id !== this.userId && id !== this.partnerId
                );

                // Initialize messages array
                data.messages[this.roomId] = [];

                this.saveNetworkData(data);
                return this.roomId;
            }

            sendMessage(text) {
                if (!this.roomId) return;

                const data = this.getNetworkData();
                const message = {
                    id: 'msg_' + Date.now(),
                    sender: this.userId,
                    text: text,
                    timestamp: Date.now(),
                    seen: false
                };

                if (!data.messages[this.roomId]) {
                    data.messages[this.roomId] = [];
                }

                data.messages[this.roomId].push(message);
                data.rooms[this.roomId].lastActivity = Date.now();
                
                this.saveNetworkData(data);
                return message;
            }

            getNewMessages() {
                if (!this.roomId) return [];
                
                const data = this.getNetworkData();
                const roomMessages = data.messages[this.roomId] || [];
                
                return roomMessages.filter(msg => 
                    msg.sender === this.partnerId && !msg.seen
                );
            }

            markMessagesAsSeen(messages) {
                if (!this.roomId) return;
                
                const data = this.getNetworkData();
                const roomMessages = data.messages[this.roomId] || [];
                
                messages.forEach(message => {
                    const msg = roomMessages.find(m => m.id === message.id);
                    if (msg) msg.seen = true;
                });
                
                this.saveNetworkData(data);
            }

            checkForNewMessages() {
                const newMessages = this.getNewMessages();
                if (newMessages.length > 0) {
                    this.markMessagesAsSeen(newMessages);
                    return newMessages;
                }
                return [];
            }

            leaveRoom() {
                if (this.roomId) {
                    const data = this.getNetworkData();
                    
                    // Remove from room
                    if (data.rooms[this.roomId]) {
                        // Mark user as offline in room
                        data.rooms[this.roomId].lastActivity = Date.now();
                    }
                    
                    // Remove from waiting
                    data.waiting = data.waiting.filter(id => id !== this.userId);
                    
                    // Update user status
                    if (data.users[this.userId]) {
                        data.users[this.userId].status = 'offline';
                        data.users[this.userId].lastSeen = Date.now();
                    }
                    
                    this.saveNetworkData(data);
                }
                
                this.roomId = null;
                this.partnerId = null;
                this.isConnected = false;
                
                if (this.checkInterval) {
                    clearInterval(this.checkInterval);
                }
            }
        }

        // CHATTELO APPLICATION
        let chattelo = null;
        let chatTimer = null;
        let chatSeconds = 0;

        function startRandomChat() {
            document.getElementById('landingPage').style.display = 'none';
            document.getElementById('textChatPage').style.display = 'flex';
            
            // Initialize network
            chattelo = new ChatteloNetwork();
            
            document.getElementById('messagesContainer').innerHTML = `
                <div class="waiting-message" id="waitingMessage">
                    <div class="spinner"></div>
                    <p>Looking for someone to chat with...</p>
                    <p style="font-size: 12px; margin-top: 10px;">Open this page in multiple tabs to test connections!</p>
                    <div class="user-count" id="searchingCount">Searching for partners...</div>
                </div>
            `;
            
            document.getElementById('messageInput').disabled = true;
            document.querySelector('.send-btn').disabled = true;
            document.getElementById('chatStatus').textContent = 'Finding a Partner...';
            
            startTimer();
            connectToPartner();
        }

        async function connectToPartner() {
            try {
                document.getElementById('searchingCount').textContent = 'Searching for partners...';
                
                const partnerId = await chattelo.joinWaitingList();
                
                if (partnerId) {
                    // Found a partner!
                    chattelo.createChatRoom();
                    chattelo.isConnected = true;
                    
                    startChatSession();
                } else {
                    // Keep searching
                    document.getElementById('searchingCount').textContent = 'No partners found yet...';
                    setTimeout(connectToPartner, 2000);
                }
            } catch (error) {
                console.log('Connection error:', error);
                setTimeout(connectToPartner, 2000);
            }
        }

        function startChatSession() {
            document.getElementById('chatStatus').textContent = 'Connected! Start chatting!';
            document.getElementById('waitingMessage').style.display = 'none';
            
            document.getElementById('messageInput').disabled = false;
            document.querySelector('.send-btn').disabled = false;
            document.getElementById('messageInput').placeholder = "Type your message...";
            document.getElementById('messageInput').focus();

            document.getElementById('messagesContainer').innerHTML = '';
            showSystemMessage("üéâ Connected with a random person! Say hello!");

            // Start listening for messages
            startMessageListener();
        }

        function startMessageListener() {
            setInterval(() => {
                if (chattelo && chattelo.isConnected) {
                    const newMessages = chattelo.checkForNewMessages();
                    newMessages.forEach(message => {
                        showMessage(message, 'received');
                    });
                }
            }, 1000);
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (text && chattelo && chattelo.isConnected) {
                const message = chattelo.sendMessage(text);
                showMessage(message, 'sent');
                input.value = '';
            }
        }

        function showMessage(messageData, type) {
            const messagesContainer = document.getElementById('messagesContainer');
            const messageDiv = document.createElement('div');
            
            messageDiv.className = `message ${type}`;
            messageDiv.innerHTML = `
                <div class="message-text">${sanitizeInput(messageData.text)}</div>
                <div class="message-time">${formatTime(messageData.timestamp)}</div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showSystemMessage(text) {
            const messagesContainer = document.getElementById('messagesContainer');
            const messageDiv = document.createElement('div');
            
            messageDiv.className = 'system-message';
            messageDiv.textContent = text;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function skipPerson() {
            if (chattelo) {
                chattelo.leaveRoom();
            }
            showSystemMessage("üîÑ Finding someone new...");
            setTimeout(() => {
                startRandomChat();
            }, 1000);
        }

        function showLandingPage() {
            if (chattelo) {
                chattelo.leaveRoom();
            }
            document.getElementById('landingPage').style.display = 'block';
            document.getElementById('textChatPage').style.display = 'none';
            resetTimer();
        }

        // Utility functions
        function startTimer() {
            resetTimer();
            chatTimer = setInterval(() => {
                chatSeconds++;
                const minutes = Math.floor(chatSeconds / 60);
                const seconds = chatSeconds % 60;
                document.getElementById('textChatTimer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function resetTimer() {
            if (chatTimer) clearInterval(chatTimer);
            chatSeconds = 0;
        }

        function formatTime(timestamp) {
            return new Date(timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }

        function sanitizeInput(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') sendMessage();
        }

        function showPremiumModal() {
            document.getElementById('premiumModal').style.display = 'flex';
        }

        function closePremiumModal() {
            document.getElementById('premiumModal').style.display = 'none';
        }

        // Initialize
        document.getElementById('statusIndicator').textContent = 'üü¢ Ready to Chat';
    </script>
</body>
</html>
